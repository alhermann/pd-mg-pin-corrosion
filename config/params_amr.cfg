# AMR production run against Reimers et al. (2023)
# Fine grid (dx=2.5um) near pin, coarse grid (dx=7.5um) in far-field fluid
# Based on params_fine_calibration.cfg with AMR enabled

# Grid
dx = 2.5e-6
m_ratio = 3

# AMR: fine zone around pin, coarse elsewhere
use_amr = 1
amr_ratio = 3
amr_buffer = 50.0e-6

# Geometry [m] — R_tube calibrated to match Reimers COMSOL (Fig 3b)
# v_max ≈ 0.047 m/s at Q=1 mL/min (was 0.45 m/s with R_tube=150um)
R_wire = 40.0e-6
L_wire = 400.0e-6
R_tube = 425.0e-6
L_upstream = 500.0e-6
L_downstream = 500.0e-6

# Fluid
rho_f = 1000.0
mu_f = 1.0e-3
gamma_eos = 7.0
c0 = 0.5
eta_density = 0.1

# Flow
Q_flow = 1.667e-8

# Mg solid
rho_m = 1738.0

# Transport — bi-material PD diffusion (Jafarzadeh, Chen & Bobaru 2018)
# D_grain/D_gb close (5x ratio): moderate GB preferential dissolution
# D_precip higher: Mg54Ag17 precipitates dissolve faster (galvanic effect)
# Solid D reduced ~20% from previous (5e-16/2.5e-15/2.5e-14) to lower vol. loss slightly
D_liquid = 1.0e-9
D_grain = 4.0e-16
D_gb = 2.0e-15
D_precip = 2.0e-14
precip_fraction = 0.05
precip_cluster_cells = 2
C_solid_init = 1.0
C_liquid_init = 0.0
C_thresh = 0.45
alpha_art_diff = 0.01

# Volume-loss-dependent micro-diffusivity (Hermann et al. 2022, Eq. 42)
# D_interface *= 10^(-V_L / corrosion_decay_l); set 0 to disable
# l=10: moderate decay (at V_L=20%, factor=0.955; at V_L=50%, factor=0.891)
corrosion_decay_l = 10.0

# Salt layer
C_sat = 0.9

# Grain structure — GB preferential dissolution enabled
grain_size_mean = 40.0e-6
grain_size_std = 5.0e-6
gb_width_cells = 0

# Time stepping
cfl_factor = 0.05
cfl_factor_corr = 0.25

# Coupling — 4.23 hours (span of experimental data)
flow_max_iters = 200000
flow_conv_tol = 1.0e-6
T_final = 15228.0
corrosion_steps_per_check = 200
output_every_flow = 10000
output_every_corr = 100
output_dir = output_amr

# Implicit ARD solver
use_implicit = 1
implicit_dt_fraction = 0.5
implicit_dt_max = 60.0
implicit_output_every = 50
diagnostic_every = 1

# Newton-Raphson
newton_tol = 1.0e-8
newton_max_iter = 20
