# AMR run with ratio=2 (smoother transition) + calibration adjustments
# Goal: reduce AMR transition smearing + fix early over / late under prediction
# Changes from params_amr.cfg:
#   - amr_ratio: 3 → 2 (dx_coarse = 5.0um instead of 7.5um)
#   - C_sat: 0.9 → 0.95 (less salt-layer blocking, sustains late corrosion)
#   - corrosion_decay_l: 10 → 0 (decay worsens late-time match, disable)

# Grid
dx = 2.5e-6
m_ratio = 3

# AMR: ratio=2 for smoother coarse-fine transition
use_amr = 1
amr_ratio = 2
amr_buffer = 50.0e-6

# Geometry [m]
R_wire = 40.0e-6
L_wire = 400.0e-6
R_tube = 425.0e-6
L_upstream = 500.0e-6
L_downstream = 500.0e-6

# Fluid
rho_f = 1000.0
mu_f = 1.0e-3
gamma_eos = 7.0
c0 = 0.5
eta_density = 0.1

# Flow
Q_flow = 1.667e-8

# Mg solid
rho_m = 1738.0

# Transport — tuned for ratio=2 AMR grid
D_liquid = 1.0e-9
D_grain = 4.5e-16
D_gb = 2.2e-15
D_precip = 2.5e-14
precip_fraction = 0.05
precip_cluster_cells = 2
C_solid_init = 1.0
C_liquid_init = 0.0
C_thresh = 0.45
alpha_art_diff = 0.01

# Volume-loss decay disabled (worsens late-time calibration)
corrosion_decay_l = 0.0

# Salt layer — raised to 0.95 (less blocking, sustains late corrosion)
C_sat = 0.95

# Grain structure
grain_size_mean = 40.0e-6
grain_size_std = 5.0e-6
gb_width_cells = 0

# Time stepping
cfl_factor = 0.05
cfl_factor_corr = 0.25

# Coupling
flow_max_iters = 200000
flow_conv_tol = 1.0e-6
T_final = 15228.0
corrosion_steps_per_check = 200
output_every_flow = 10000
output_every_corr = 100
output_dir = output_amr_r2

# Implicit ARD solver
use_implicit = 1
implicit_dt_fraction = 0.5
implicit_dt_max = 60.0
implicit_output_every = 50
diagnostic_every = 1

# Newton-Raphson
newton_tol = 1.0e-8
newton_max_iter = 20
